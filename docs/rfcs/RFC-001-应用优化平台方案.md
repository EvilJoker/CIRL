# RFC-001: 应用问答优化平台（当前方案）

**状态**：Stable
**所属层**：方案层
**创建日期**：2025-01-20

## 1. 背景

团队希望将 CIRL 平台聚焦到“应用（App）粒度”的问答质量治理：记录问答、收集反馈、构建数据集、分析命中并评估准确性/速度。该文档总结当前稳定方案，供开发、运维与后续 RFC 参考。

## 2. 范围

- App 管理与问答记录
- 反馈闭环与优化建议
- 数据集管理、命中分析、效果评估
- API/数据模型与前端页面框架

超出范围：知识项维护、RAG/LLM 细节、权限体系、多租户。

## 3. 方案概述

### 3.1 核心流程

1. **记录问答**：外部应用调用 `POST /api/query-records` 注入 input/output、模型、响应时间等。
2. **提交反馈**：人工或 AI 通过 `POST /api/feedbacks` 反馈答案效果，可带评分/纠正。
3. **生成数据集**：运营选择一批高质量问答记录构建数据集，作为标准答案库。
4. **命中分析**：定期对最近问答与数据集计算相似度，统计完全/80%/60%/未命中。
5. **效果评估**：在优化前后调用 `POST /api/evaluations`，评估准确率 + 速度，对比 `GET /api/evaluations/compare`。
6. **优化建议**：反馈或命中分析触发 AI 占位逻辑，生成 `optimization-suggestions`，支持后续跟踪。

### 3.2 页面与 API 对应

| 页面 | API |
| --- | --- |
| 应用管理 | `GET/POST/PUT/DELETE /api/apps` |
| 问答跟踪 | `GET /api/query-records`，`POST /api/query-records`，`POST /api/feedbacks` |
| 反馈管理 | `GET/PUT /api/feedbacks`，`POST /api/feedbacks/:id/analyze` |
| 数据集管理 | `GET/POST/PUT/DELETE /api/datasets`，`GET /api/query-records` （选择记录） |
| 命中分析 | `POST /api/hit-analyses`，`GET /api/hit-analyses`，`GET /api/hit-analyses/stats` |
| 效果评估 | `POST /api/evaluations`，`GET /api/evaluations`，`GET /api/evaluations/compare` |

### 3.3 数据模型摘要

详见 `docs/design.md`，包含：
- `App`
- `QueryRecord`
- `Feedback`
- `Dataset`
- `HitAnalysis`
- `Evaluation`
- `OptimizationSuggestion`

存储在 `data/*.json` 中，便于调试/导出。

## 4. 实施要点

- **Similarity Service**：`server/similarityService.js` 采用余弦+编辑距离加权，可替换为真实 AI。
- **Evaluation Service**：`server/evaluationService.js` 统一计算 accuracy/speed/命中率/评分。
- **前端**：采用 shadcn-vue + Vue Router，Sidebar 导航六大页面。
- **文档**：设计总纲、实施计划、API 参考均已更新为 App 粒度。

## 5. 后续方向

- 接入真实相似度/评估 AI 服务
- 支持定时任务、批量分析与导出
- 引入权限、多租户及更丰富的图表

---

> 本 RFC 作为当前方案的“快照”，后续如需重大调整，请新增 RFC（例如 AI 服务接入、权限体系等），保持方案层清晰可追溯。

